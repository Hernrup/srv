{
  consul: "localhost:8500",
  logging: {
    level: "INFO",
    format: "default",
    output: "stdout"
  },
  jobs: [
    {
      name: "kibana",
      exec: ["/usr/local/bin/kibana-docker"],
      restarts: "unlimited",
      port: 5601,
      health: {
        exec: ["/bin/bash", "-c", "/usr/bin/curl --fail --silent --show-error localhost:5601/api/status | jq \".status.overall.state\" | grep -q green"],
        interval: 30,
        ttl: 60
      },
      tags: [{{ range $TAG := env "TAGS" | split ";" }}"{{ $TAG }}", {{ end }}],
    },
    {
      name: "consul-agent",
      exec: "/usr/local/bin/consul_agent.sh",
      restarts: "unlimited",
      stopTimeout: "5s",
    },
    {
      name: "consul-leave",
      exec: "consul leave",
      when: {
        source: "consul-agent",
        once: "stopping"
      }
    },
    {
      name: "telegraf-consul-template",
      exec: ["consul-template", "-config", "/etc/consul_template/telegraf.json"],
      restarts: "unlimited"
    },
  ],
  telemetry: {
    port: 9090,
    interfaces: ["static:127.0.0.1"]
  }
}

